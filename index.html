<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ü–†–ê–ô–ú –°–ö–£–î ‚Äî –¢–°–ñ –ü–∞—Ä—É—Å–∞ –Ω–∞–¥ –ö–∞–º–æ–π</title>
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="–í–æ—Ä–æ—Ç–∞">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }

    .container {
      background: white;
      border-radius: 24px;
      padding: 25px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header .logo {
      font-size: 42px;
      margin-bottom: 8px;
    }

    .header h1 {
      color: #333;
      font-size: 18px;
      margin-bottom: 4px;
    }

    .header .subtitle {
      color: #888;
      font-size: 12px;
    }

    .object-card {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
      border-radius: 16px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
    }

    .object-card .name {
      font-size: 15px;
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .object-card .link {
      font-size: 11px;
      color: #888;
      word-break: break-all;
    }

    .object-card .status {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: #e8f5e9;
      color: #2e7d32;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      margin-top: 8px;
    }

    .object-card .status .dot {
      width: 6px;
      height: 6px;
      background: #4caf50;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .gates {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .gate-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      padding: 16px;
      font-size: 15px;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      text-decoration: none;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      border: none;
      cursor: pointer;
    }

    .gate-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .gate-link:active {
      transform: translateY(0) scale(0.97);
    }

    .gate-link .icon {
      font-size: 18px;
    }

    .info-box {
      background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%);
      color: #856404;
      padding: 14px;
      border-radius: 12px;
      margin-top: 15px;
      font-size: 12px;
      line-height: 1.5;
      border: 1px solid #ffc107;
    }

    .info-box strong {
      display: block;
      margin-bottom: 6px;
      color: #664d03;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-group label {
      display: block;
      font-size: 13px;
      color: #555;
      margin-bottom: 6px;
      font-weight: 500;
    }

    .input-group input {
      width: 100%;
      padding: 12px 14px;
      font-size: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      outline: none;
      transition: border-color 0.2s;
    }

    .input-group input:focus {
      border-color: #667eea;
    }

    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 14px;
      font-size: 15px;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      margin-bottom: 8px;
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #90a4ae 0%, #78909c 100%);
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .footer {
      text-align: center;
      margin-top: 20px;
      padding-top: 12px;
      border-top: 1px solid #eee;
      font-size: 10px;
      color: #aaa;
    }

    .footer a {
      color: #667eea;
      text-decoration: none;
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 20px;
        border-radius: 20px;
      }

      .header h1 {
        font-size: 17px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- –≠–∫—Ä–∞–Ω 1: –í—ã–±–æ—Ä —Å—Å—ã–ª–∫–∏ -->
    <div class="screen active" id="screenSelect">
      <div class="header">
        <div class="logo">üè†</div>
        <h1>–ü–†–ê–ô–ú –°–ö–£–î</h1>
        <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º</p>
      </div>

      <div class="input-group">
        <label>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞ –¥–æ—Å—Ç—É–ø–∞:</label>
        <input type="url" id="accessLink" placeholder="https://prime-skud.ru/a/..." autocomplete="off">
      </div>

      <button class="btn" onclick="saveAndOpen()">
        <span>üöÄ</span>
        <span>–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–æ—Ä–æ—Ç</span>
      </button>

      <button class="btn btn-secondary" onclick="showGatesScreen()">
        <span>üì±</span>
        <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Å—ã–ª–∫—É</span>
      </button>

      <div class="info-box">
        <strong>‚ÑπÔ∏è –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong>
        –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é.<br>
        –û—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ü–†–ê–ô–ú –°–ö–£–î –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–æ—Ä–æ—Ç.
      </div>

      <div class="footer">
        <p>–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω <a href="https://prime-pult.ru/" target="_blank">–ü–†–ê–ô–ú –ü–£–õ–¨–¢</a></p>
        <p style="margin-top: 4px;">üá∑üá∫ –°–¥–µ–ª–∞–Ω–æ –≤ –†–æ—Å—Å–∏–∏</p>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 2: –ö–Ω–æ–ø–∫–∏-—Å—Å—ã–ª–∫–∏ -->
    <div class="screen" id="screenGates">
      <div class="header">
        <div class="logo">üè†</div>
        <h1>–¢–°–ñ –ü–∞—Ä—É—Å–∞ –Ω–∞–¥ –ö–∞–º–æ–π</h1>
        <p class="subtitle">–ü–†–ê–ô–ú –°–ö–£–î</p>
      </div>

      <div class="object-card">
        <div class="name">–¢–°–ñ –ü–∞—Ä—É—Å–∞ –Ω–∞–¥ –ö–∞–º–æ–π</div>
        <div class="link" id="displayLink"></div>
        <div class="status">
          <span class="dot" id="statusDot"></span>
          <span id="statusText">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
        </div>
      </div>

      <div class="gates">
        <button class="gate-link" id="gate1" onclick="openGate('1225')">
          <span class="icon">üö™</span>
          <span>–í–æ—Ä–æ—Ç–∞ 1</span>
        </button>
        <button class="gate-link" id="gate2" onclick="openGate('2390')">
          <span class="icon">üö™</span>
          <span>–í–æ—Ä–æ—Ç–∞ 2</span>
        </button>
        <button class="gate-link" id="gate3" onclick="openGate('2394')">
          <span class="icon">üö™</span>
          <span>–í–æ—Ä–æ—Ç–∞ 3</span>
        </button>
        <button class="gate-link" id="gate4" onclick="openGate('2925')">
          <span class="icon">üè¢</span>
          <span>–ü–æ–¥—ä–µ–∑–¥ –ö37</span>
        </button>
      </div>

      <div class="info-box">
        <strong>üì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong>
        –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω—É–∂–Ω—ã—Ö –≤–æ—Ä–æ—Ç. –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤ –≤–æ—Ä–æ—Ç–∞!
      </div>

      <button class="btn btn-secondary" onclick="showSelectScreen()" style="margin-top: 12px;">
        <span>‚öôÔ∏è</span>
        <span>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É</span>
      </button>

      <div class="footer">
        <p>–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω <a href="https://prime-pult.ru/" target="_blank">–ü–†–ê–ô–ú –ü–£–õ–¨–¢</a></p>
        <p style="margin-top: 4px;">üá∑üá∫ –°–¥–µ–ª–∞–Ω–æ –≤ –†–æ—Å—Å–∏–∏</p>
      </div>
    </div>
  </div>

  <script>
    // –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –í–ê–® CLOUDFLARE WORKER URL:
    const WORKER_URL = 'https://gate-open.nikisolo946.workers.dev/';

    let currentUrl = '';
    let primeCookie = '';

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    window.addEventListener('load', () => {
      currentUrl = localStorage.getItem('primeSkudUrl') || '';
      primeCookie = localStorage.getItem('primeCookie') || '';

      if (currentUrl) {
        document.getElementById('accessLink').value = currentUrl;
      }
    });

    // –§—É–Ω–∫—Ü–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø—Ä–æ–∫—Å–∏
    async function fetchProxy(url, params = null) {
      const headers = {
        'X-Target-Url': url,
      };
      if (primeCookie) {
        headers['X-Prime-Cookie'] = primeCookie;
      }

      const options = {
        method: params ? 'POST' : 'GET',
        headers: headers
      };

      if (params) {
        options.body = params.toString();
      }

      const res = await fetch(WORKER_URL, options);

      // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫—É–∫—É –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –µ–µ –≤—ã–¥–∞–ª
      const newCookie = res.headers.get('X-Set-Prime-Cookie');
      if (newCookie) {
        primeCookie = newCookie;
        localStorage.setItem('primeCookie', newCookie);
        console.log("Cookie –æ–±–Ω–æ–≤–ª–µ–Ω–∞:", primeCookie);
      }

      const responseHtml = await res.text();

      // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
      const lowerHtml = responseHtml.toLowerCase();
      if (lowerHtml.includes('—É–¥–∞–ª–µ–Ω–∞') || lowerHtml.includes('–Ω–µ –Ω–∞–π–¥–µ–Ω–∞')) {
        throw new Error('LINK_DELETED');
      }
      if (lowerHtml.includes('–¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ')) {
        throw new Error('LINK_STOLEN');
      }

      return responseHtml;
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã –±–µ–π–¥–∂–∞ —Å—Ç–∞—Ç—É—Å–∞
    function setStatus(type) {
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');

      switch (type) {
        case 'ACTIVATED':
          text.innerText = '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ';
          dot.style.background = '#4caf50'; // –ó–µ–ª–µ–Ω—ã–π
          break;
        case 'NEEDS_ACTIVATION':
          text.innerText = '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è';
          dot.style.background = '#ff9800'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
          break;
        case 'ERROR_DELETED':
          text.innerText = '–û—à–∏–±–∫–∞: –°—Å—ã–ª–∫–∞ —É–¥–∞–ª–µ–Ω–∞';
          dot.style.background = '#f44336'; // –ö—Ä–∞—Å–Ω—ã–π
          break;
        case 'ERROR_STOLEN':
          text.innerText = '–û—à–∏–±–∫–∞: –î—Ä—É–≥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ';
          dot.style.background = '#f44336'; // –ö—Ä–∞—Å–Ω—ã–π
          break;
        case 'ERROR_NETWORK':
          text.innerText = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏';
          dot.style.background = '#f44336'; // –ö—Ä–∞—Å–Ω—ã–π
          break;
        default:
          text.innerText = '–û–∂–∏–¥–∞–Ω–∏–µ...';
          dot.style.background = '#9e9e9e'; // –°–µ—Ä—ã–π
          break;
      }
    }

    async function saveAndOpen() {
      const input = document.getElementById('accessLink');
      let url = input.value.trim();

      if (!url) return alert('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É!');
      if (!url.startsWith('http')) url = 'https://' + url;
      if (!url.includes('prime-skud.ru/a/')) return alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏!');

      const btn = event.currentTarget;
      const originHtml = btn.innerHTML;
      btn.innerHTML = '<span>‚è≥</span><span>–ê–∫—Ç–∏–≤–∞—Ü–∏—è...</span>';
      btn.disabled = true;

      try {
        if (!WORKER_URL || WORKER_URL.includes("–≤–∞—à–µ-–∏–º—è-—Ä–∞–±–æ—Ç–Ω–∏–∫–∞")) {
          throw new Error("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å Cloudflare Worker –≤ –∫–æ–¥–µ (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ WORKER_URL)");
        }

        localStorage.setItem('primeSkudUrl', url);
        currentUrl = url;

        // –û—á–∏—â–∞–µ–º –∫—É–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –Ω–æ–≤–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
        primeCookie = '';
        localStorage.removeItem('primeCookie');

        // –®–∞–≥ 1: –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        let responseHtml = await fetchProxy(url);

        // –ï—Å–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (act_me=1)
        if (responseHtml.includes('act_me=')) {
          console.log("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ –∫–Ω–æ–ø–∫–µ...");
          const params = new URLSearchParams();
          params.append('act_me', '1');
          await fetchProxy(url, params); // –≤—ã–∑–æ–≤–µ—Ç POST –∑–∞–ø—Ä–æ—Å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
        }

        // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞ –∏ –Ω–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–æ–º
        showGatesScreen('ACTIVATED');

      } catch (e) {
        // –ú—ã –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –∏–¥–µ–º –Ω–∞ –≤—Ç–æ—Ä–æ–π —ç–∫—Ä–∞–Ω, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞–º –∫—Ä–∞—Å–Ω—É—é –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        console.error("–ü–æ–π–º–∞–Ω–∞ –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:", e.message);

        if (e.message === 'LINK_DELETED') {
          showGatesScreen('ERROR_DELETED');
        } else if (e.message === 'LINK_STOLEN') {
          showGatesScreen('ERROR_STOLEN');
        } else {
          alert('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + e.message);
        }
      } finally {
        btn.innerHTML = originHtml;
        btn.disabled = false;
      }
    }

    async function openGate(gateId) {
      const btn = event.currentTarget;
      const originHtml = btn.innerHTML;

      // –°–ø–∏–Ω–Ω–µ—Ä
      btn.innerHTML = '<span class="icon">‚è≥</span><span>–û—Ç–∫—Ä—ã–≤–∞—é...</span>';
      btn.disabled = true;

      try {
        const params = new URLSearchParams();
        params.append('d', gateId);
        params.append('r', '1');

        await fetchProxy(currentUrl, params);

        // –£—Å–ø–µ—Ö
        btn.style.background = 'linear-gradient(135deg, #43a047 0%, #2e7d32 100%)';
        btn.innerHTML = '<span class="icon">‚úÖ</span><span>–û—Ç–∫—Ä—ã—Ç–æ!</span>';
        setStatus('ACTIVATED'); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º, —á—Ç–æ –≤—Å—ë –æ–∫

        setTimeout(() => {
          btn.style.background = '';
          btn.innerHTML = originHtml;
          btn.disabled = false;
        }, 2000);

      } catch (err) {
        // –û—à–∏–±–∫–∞ - –∫–Ω–æ–ø–∫–∞ –∫—Ä–∞—Å–Ω–µ–µ—Ç
        btn.style.background = 'linear-gradient(135deg, #e53935 0%, #c62828 100%)';
        btn.innerHTML = '<span class="icon">‚ùå</span><span>–û—à–∏–±–∫–∞</span>';

        // –ú–µ–Ω—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
        if (err.message === 'LINK_DELETED') {
          setStatus('ERROR_DELETED');
          localStorage.removeItem('primeCookie');
          primeCookie = '';
        } else if (err.message === 'LINK_STOLEN') {
          setStatus('ERROR_STOLEN');
          localStorage.removeItem('primeCookie');
          primeCookie = '';
        } else {
          setStatus('ERROR_NETWORK');
        }

        setTimeout(() => {
          btn.style.background = '';
          btn.innerHTML = originHtml;
          btn.disabled = false;
        }, 2000);
      }
    }

    function showGatesScreen(overrideStatus = null) {
      if (!currentUrl) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É!');
        return;
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É
      const shortLink = currentUrl.split('/a/')[1]?.split('?')[0] || currentUrl;
      document.getElementById('displayLink').textContent = '#' + shortLink;

      document.getElementById('screenSelect').classList.remove('active');
      document.getElementById('screenGates').classList.add('active');

      if (overrideStatus) {
        setStatus(overrideStatus);
      } else if (primeCookie) {
        setStatus('ACTIVATED');
      } else {
        setStatus('NEEDS_ACTIVATION');
      }
    }

    function showSelectScreen() {
      document.getElementById('screenGates').classList.remove('active');
      document.getElementById('screenSelect').classList.add('active');
    }
  </script>
</body>

</html>